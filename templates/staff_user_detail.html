{% extends "staff_base.html" %}
{% block title %}User Detail{% endblock %}
{% block content %}

<form method="post" action="{% url 'staff_user_update' u.id %}">
  {% csrf_token %}

  <!-- HEADER -->
  <div class="card-h">
    <div>
      <div class="h1">User: {{ u.phone }}</div>
      <div class="muted">Edit user detail</div>
    </div>

    <!-- ✅ Top right: Save + Back -->
    <div style="display:flex; gap:10px; align-items:center;">
      <button class="savebtn" type="submit">Save</button>
      <a class="btn" href="{% url 'staff_users' %}">← Back</a>
    </div>
  </div>

  <div class="content">
    <div class="user-detail-form">

      <!-- ✅ Balance -->
      <p>
        <label>Balance</label>
        <input type="text" name="balance" value="{{ u.balance }}">
      </p>

      <!-- ✅ Withdraw OTP (MOVED HERE just under balance) -->
      {% for field in form %}
        {% if field.name == "withdraw_otp" %}
          <p>
            {{ field.label_tag }}
            {{ field }}
            {% if field.errors %}
              <span class="muted">{{ field.errors|striptags }}</span>
            {% endif %}
          </p>
        {% endif %}
      {% endfor %}
      
      {% for field in form %}
  {% if field.name == "credit_score" %}
    <p>
      {{ field.label_tag }}
      {{ field }}
      {% if field.errors %}
        <span class="muted">{{ field.errors|striptags }}</span>
      {% endif %}
    </p>
  {% endif %}
{% endfor %}

      <!-- ✅ Other user fields (exclude withdraw_otp + is_staff) -->
      {% for field in form %}
  {% if field.name != "withdraw_otp" and field.name != "credit_score" and field.name != "is_staff" %}

          {% if field.name == "notification_message" %}
            <p>
              <label for="{{ field.id_for_label }}">Alert message</label>
              {{ field }}
              {% if field.errors %}
                <span class="muted">{{ field.errors|striptags }}</span>
              {% endif %}
            </p>
          {% else %}
            <p>
              {{ field.label_tag }}
              {{ field }}
              {% if field.errors %}
                <span class="muted">{{ field.errors|striptags }}</span>
              {% endif %}
            </p>
          {% endif %}

        {% endif %}
      {% endfor %}

      <!-- ✅ Payment Info -->
      <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.18);">
        <div class="h1" style="font-size:14px;margin-bottom:10px;">Payment Info</div>

        <div style="display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr));">
          <div>
            <label>BANK : bank name</label>
            {{ pm_form.bank_name }}
          </div>
          <div>
            <label>BANK : bank number</label>
            {{ pm_form.bank_account }}
          </div>

          <div>
            <label>WALLET : wallet name</label>
            {{ pm_form.wallet_name }}
          </div>
          <div>
            <label>WALLET : wallet number</label>
            {{ pm_form.wallet_phone }}
          </div>

          <div style="grid-column:1 / -1;">
            <label>PAYPAL : paypal email</label>
            {{ pm_form.paypal_email }}
          </div>
        </div>
      </div>

    </div>
  </div>

</form>
<style>
  /* staff_user.html only */
  label, .label, .form-label, .field label, .content label{
    color:#fff !important;
    opacity:.95;
  }
  </style>

{% endblock %}